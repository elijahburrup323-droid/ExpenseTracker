<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-6">
    <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400 mb-2">
      <%= link_to "Documentation", documentation_path, class: "hover:text-brand-600 dark:hover:text-brand-400 transition" %>
      <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
      <span class="text-gray-900 dark:text-white font-medium">Architecture Overview</span>
    </div>
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Architecture Overview</h1>
    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">How all the pieces connect in BudgetHQ</p>
  </div>

  <%# Request Flow Diagram %>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Request Flow</h2>
    <div class="overflow-x-auto">
      <div class="flex items-center justify-center gap-2 min-w-[700px] py-4">
        <%# Browser %>
        <div class="flex flex-col items-center">
          <div class="w-32 h-20 rounded-lg bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-300 dark:border-blue-700 flex items-center justify-center">
            <div class="text-center">
              <svg class="h-6 w-6 mx-auto text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
              <span class="text-xs font-semibold text-blue-700 dark:text-blue-300">Browser</span>
            </div>
          </div>
          <span class="text-[10px] text-gray-400 mt-1">User interaction</span>
        </div>

        <svg class="h-5 w-8 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 32 20" stroke="currentColor" stroke-width="2"><path d="M2 10h24m0 0l-6-6m6 6l-6 6"/></svg>

        <%# Stimulus %>
        <div class="flex flex-col items-center">
          <div class="w-36 h-20 rounded-lg bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-400 dark:border-yellow-700 flex items-center justify-center">
            <div class="text-center">
              <span class="text-lg font-bold text-yellow-600 dark:text-yellow-400">S</span>
              <div class="text-xs font-semibold text-yellow-700 dark:text-yellow-300">Stimulus</div>
              <div class="text-[10px] text-yellow-600 dark:text-yellow-400">Controller</div>
            </div>
          </div>
          <span class="text-[10px] text-gray-400 mt-1">State machine + DOM</span>
        </div>

        <div class="flex flex-col items-center flex-shrink-0">
          <svg class="h-5 w-8 text-gray-400" fill="none" viewBox="0 0 32 20" stroke="currentColor" stroke-width="2"><path d="M2 10h24m0 0l-6-6m6 6l-6 6"/></svg>
          <span class="text-[10px] font-mono text-green-600 dark:text-green-400 -mt-1">fetch()</span>
        </div>

        <%# API Controller %>
        <div class="flex flex-col items-center">
          <div class="w-36 h-20 rounded-lg bg-green-50 dark:bg-green-900/30 border-2 border-green-400 dark:border-green-700 flex items-center justify-center">
            <div class="text-center">
              <svg class="h-6 w-6 mx-auto text-green-600 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2"/></svg>
              <div class="text-xs font-semibold text-green-700 dark:text-green-300">Api::Controller</div>
            </div>
          </div>
          <span class="text-[10px] text-gray-400 mt-1">JSON CRUD</span>
        </div>

        <svg class="h-5 w-8 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 32 20" stroke="currentColor" stroke-width="2"><path d="M2 10h24m0 0l-6-6m6 6l-6 6"/></svg>

        <%# Model %>
        <div class="flex flex-col items-center">
          <div class="w-32 h-20 rounded-lg bg-purple-50 dark:bg-purple-900/30 border-2 border-purple-400 dark:border-purple-700 flex items-center justify-center">
            <div class="text-center">
              <svg class="h-6 w-6 mx-auto text-purple-600 dark:text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
              <div class="text-xs font-semibold text-purple-700 dark:text-purple-300">Model</div>
            </div>
          </div>
          <span class="text-[10px] text-gray-400 mt-1">Validations + scopes</span>
        </div>

        <svg class="h-5 w-8 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 32 20" stroke="currentColor" stroke-width="2"><path d="M2 10h24m0 0l-6-6m6 6l-6 6"/></svg>

        <%# PostgreSQL %>
        <div class="flex flex-col items-center">
          <div class="w-32 h-20 rounded-lg bg-indigo-50 dark:bg-indigo-900/30 border-2 border-indigo-400 dark:border-indigo-700 flex items-center justify-center">
            <div class="text-center">
              <svg class="h-6 w-6 mx-auto text-indigo-600 dark:text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/></svg>
              <div class="text-xs font-semibold text-indigo-700 dark:text-indigo-300">PostgreSQL</div>
            </div>
          </div>
          <span class="text-[10px] text-gray-400 mt-1">Persistent storage</span>
        </div>
      </div>
    </div>
  </div>

  <%# Sidebar Layout %>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Sidebar Layout</h2>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <div class="lg:col-span-1 bg-gradient-to-b from-brand-700 to-brand-900 rounded-lg p-4 text-white text-sm">
        <div class="font-bold text-brand-200 mb-3">Sidebar (w-56 / w-16)</div>
        <div class="space-y-2 text-brand-100">
          <div class="font-semibold text-white">Accounts</div>
          <div class="pl-3 text-xs space-y-1">
            <div>Account Types</div>
          </div>
          <div class="font-semibold text-white">Deposits</div>
          <div class="pl-3 text-xs space-y-1">
            <div>Frequencies</div>
            <div>Recurring Deposits</div>
          </div>
          <div class="font-semibold text-white">Payments</div>
          <div class="pl-3 text-xs space-y-1">
            <div>Categories</div>
            <div>Spending Types</div>
          </div>
          <div class="font-semibold text-white border-t border-brand-600 pt-2 mt-2">Admin</div>
          <div class="pl-3 text-xs space-y-1">
            <div>DBU</div>
            <div>Documentation</div>
            <div>Frequency Masters</div>
            <div>Users</div>
          </div>
        </div>
        <div class="border-t border-brand-600 mt-3 pt-3 text-xs text-brand-200">
          Profile: Theme | Settings | Sign Out
        </div>
      </div>
      <div class="lg:col-span-2 space-y-3">
        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 border border-gray-200 dark:border-gray-600">
          <span class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Sticky Header (z-30)</span>
          <div class="mt-1 text-sm text-gray-700 dark:text-gray-300">Hello {name} | Quote | Date | Profile dropdown</div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 border border-gray-200 dark:border-gray-600">
          <span class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Page Toolbar (z-20, sticky below header)</span>
          <div class="mt-1 text-sm text-gray-700 dark:text-gray-300">Page title (h1) | Action buttons (Add, Export, Generate)</div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 border border-gray-200 dark:border-gray-600 min-h-[120px]">
          <span class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Main Content Area</span>
          <div class="mt-1 text-sm text-gray-700 dark:text-gray-300">Stimulus-managed data table with inline edit, filter bar, sort headers</div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 border border-gray-200 dark:border-gray-600">
          <span class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Footer</span>
          <div class="mt-1 text-sm text-gray-700 dark:text-gray-300">Contact | Help | Terms | Privacy | &copy; BudgetHQ</div>
        </div>
      </div>
    </div>
  </div>

  <%# State Machine %>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Stimulus State Machine</h2>
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Every CRUD screen follows the same three-state pattern. Only one state is active at a time.</p>
    <div class="flex items-center justify-center gap-4 flex-wrap py-4">
      <div class="w-32 h-16 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500 flex items-center justify-center">
        <span class="text-sm font-bold text-gray-700 dark:text-gray-200">idle</span>
      </div>
      <div class="flex flex-col items-center">
        <svg class="h-5 w-10 text-green-500" fill="none" viewBox="0 0 40 20" stroke="currentColor" stroke-width="2"><path d="M2 10h32m0 0l-6-6m6 6l-6 6"/></svg>
        <span class="text-[10px] text-green-600 dark:text-green-400">Add clicked</span>
      </div>
      <div class="w-32 h-16 rounded-lg bg-green-100 dark:bg-green-900/30 border-2 border-green-400 dark:border-green-600 flex items-center justify-center">
        <span class="text-sm font-bold text-green-700 dark:text-green-300">adding</span>
      </div>
      <div class="hidden sm:flex flex-col items-center">
        <svg class="h-5 w-10 text-gray-400" fill="none" viewBox="0 0 40 20" stroke="currentColor" stroke-width="2"><path d="M2 10h32m0 0l-6-6m6 6l-6 6"/></svg>
        <span class="text-[10px] text-gray-500">Save/Cancel</span>
      </div>
      <div class="hidden sm:flex w-32 h-16 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500 items-center justify-center">
        <span class="text-sm font-bold text-gray-700 dark:text-gray-200">idle</span>
      </div>
    </div>
    <div class="flex items-center justify-center gap-4 flex-wrap py-2">
      <div class="w-32 h-16 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500 flex items-center justify-center">
        <span class="text-sm font-bold text-gray-700 dark:text-gray-200">idle</span>
      </div>
      <div class="flex flex-col items-center">
        <svg class="h-5 w-10 text-blue-500" fill="none" viewBox="0 0 40 20" stroke="currentColor" stroke-width="2"><path d="M2 10h32m0 0l-6-6m6 6l-6 6"/></svg>
        <span class="text-[10px] text-blue-600 dark:text-blue-400">Row clicked</span>
      </div>
      <div class="w-32 h-16 rounded-lg bg-blue-100 dark:bg-blue-900/30 border-2 border-blue-400 dark:border-blue-600 flex items-center justify-center">
        <span class="text-sm font-bold text-blue-700 dark:text-blue-300">editing</span>
      </div>
      <div class="hidden sm:flex flex-col items-center">
        <svg class="h-5 w-10 text-gray-400" fill="none" viewBox="0 0 40 20" stroke="currentColor" stroke-width="2"><path d="M2 10h32m0 0l-6-6m6 6l-6 6"/></svg>
        <span class="text-[10px] text-gray-500">Enter/Escape</span>
      </div>
      <div class="hidden sm:flex w-32 h-16 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500 items-center justify-center">
        <span class="text-sm font-bold text-gray-700 dark:text-gray-200">idle</span>
      </div>
    </div>
  </div>

  <%# Key Conventions %>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Key Conventions</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800">
        <h3 class="text-sm font-semibold text-red-800 dark:text-red-300 mb-2">Soft Delete</h3>
        <p class="text-xs text-red-700 dark:text-red-400">All models use <code class="bg-red-100 dark:bg-red-900/40 px-1 rounded">deleted_at</code> timestamp. <code class="bg-red-100 dark:bg-red-900/40 px-1 rounded">default_scope</code> excludes deleted records. Never actually destroy rows.</p>
      </div>
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
        <h3 class="text-sm font-semibold text-blue-800 dark:text-blue-300 mb-2">User Scoping</h3>
        <p class="text-xs text-blue-700 dark:text-blue-400">Every query uses <code class="bg-blue-100 dark:bg-blue-900/40 px-1 rounded">current_user.model</code>. No cross-user data leaks. User-owned models belong_to :user.</p>
      </div>
      <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
        <h3 class="text-sm font-semibold text-green-800 dark:text-green-300 mb-2">Transactional Balance</h3>
        <p class="text-xs text-green-700 dark:text-green-400">Payments and received deposits adjust <code class="bg-green-100 dark:bg-green-900/40 px-1 rounded">account.balance</code> atomically inside DB transactions.</p>
      </div>
      <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800">
        <h3 class="text-sm font-semibold text-purple-800 dark:text-purple-300 mb-2">No Turbo Frames</h3>
        <p class="text-xs text-purple-700 dark:text-purple-400">All data ops go through <code class="bg-purple-100 dark:bg-purple-900/40 px-1 rounded">fetch()</code> to <code class="bg-purple-100 dark:bg-purple-900/40 px-1 rounded">/api/*</code> endpoints. Stimulus renders HTML via innerHTML.</p>
      </div>
      <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800">
        <h3 class="text-sm font-semibold text-yellow-800 dark:text-yellow-300 mb-2">Auto-Cancel Editing</h3>
        <p class="text-xs text-yellow-700 dark:text-yellow-400">Clicking Add/Edit/Delete while another row is being edited auto-cancels the previous edit. No explicit cancel needed.</p>
      </div>
      <div class="bg-indigo-50 dark:bg-indigo-900/20 rounded-lg p-4 border border-indigo-200 dark:border-indigo-800">
        <h3 class="text-sm font-semibold text-indigo-800 dark:text-indigo-300 mb-2">Delete Guards</h3>
        <p class="text-xs text-indigo-700 dark:text-indigo-400">Accounts, categories, and spending types cannot be deleted if they have dependent records. API returns 422 with descriptive message.</p>
      </div>
    </div>
  </div>
</div>
