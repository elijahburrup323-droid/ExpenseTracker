<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-6">
    <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400 mb-2">
      <%= link_to "Documentation", documentation_path, class: "hover:text-brand-600 dark:hover:text-brand-400 transition" %>
      <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
      <span class="text-gray-900 dark:text-white font-medium">Test Coverage</span>
    </div>
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Test Coverage Report</h1>
    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Auto-generated from Playwright test files in <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">tests/</code></p>
  </div>

  <%# Summary Cards %>
  <% local_tests = @test_files.reject { |f| f[:production] } %>
  <% prod_tests = @test_files.select { |f| f[:production] } %>
  <% total_test_count = @test_files.sum { |f| f[:test_count] } %>
  <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-4 text-center">
      <div class="text-2xl font-bold text-brand-600 dark:text-brand-400"><%= @test_files.length %></div>
      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Test Files</div>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-4 text-center">
      <div class="text-2xl font-bold text-brand-600 dark:text-brand-400"><%= total_test_count %></div>
      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Total Tests</div>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-4 text-center">
      <div class="text-2xl font-bold text-green-600 dark:text-green-400"><%= local_tests.length %></div>
      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Local Suites</div>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-4 text-center">
      <div class="text-2xl font-bold text-blue-600 dark:text-blue-400"><%= prod_tests.length %></div>
      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Production Suites</div>
    </div>
  </div>

  <%# Local Test Suites %>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Local Test Suites</h2>
    <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Run against <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">http://localhost:3000</code> on Chromium and WebKit</p>
    <div class="space-y-3">
      <% local_tests.each do |tf| %>
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
          <div class="flex items-center justify-between px-4 py-3 bg-gray-50 dark:bg-gray-700/50">
            <div>
              <span class="text-sm font-medium text-gray-900 dark:text-white"><%= tf[:suite] %></span>
              <span class="ml-2 text-xs text-gray-500 dark:text-gray-400 font-mono"><%= tf[:name] %></span>
            </div>
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/40 text-green-700 dark:text-green-300">
              <%= tf[:test_count] %> test<%= tf[:test_count] != 1 ? 's' : '' %>
            </span>
          </div>
          <% if tf[:tests].any? %>
            <div class="px-4 py-2 space-y-1">
              <% tf[:tests].each do |test_name| %>
                <div class="flex items-center gap-2">
                  <svg class="h-3.5 w-3.5 text-green-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                  <span class="text-xs text-gray-700 dark:text-gray-300"><%= test_name %></span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <%# Production Test Suites %>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Production Test Suites</h2>
    <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Run against <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">https://djburrup.com/expensetracker</code> with both accounts</p>
    <div class="space-y-3">
      <% prod_tests.each do |tf| %>
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
          <div class="flex items-center justify-between px-4 py-3 bg-blue-50 dark:bg-blue-900/20">
            <div>
              <span class="text-sm font-medium text-gray-900 dark:text-white"><%= tf[:suite] %></span>
              <span class="ml-2 text-xs text-gray-500 dark:text-gray-400 font-mono"><%= tf[:name] %></span>
            </div>
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300">
              <%= tf[:test_count] %> test<%= tf[:test_count] != 1 ? 's' : '' %>
            </span>
          </div>
          <% if tf[:tests].any? %>
            <div class="px-4 py-2 space-y-1">
              <% tf[:tests].each do |test_name| %>
                <div class="flex items-center gap-2">
                  <svg class="h-3.5 w-3.5 text-blue-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                  <span class="text-xs text-gray-700 dark:text-gray-300"><%= test_name %></span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <%# Screen Coverage Matrix %>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Screen Coverage Matrix</h2>
    <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Which screens have test coverage</p>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="border-b border-gray-200 dark:border-gray-700">
            <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Screen</th>
            <th class="px-4 py-2 text-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Local</th>
            <th class="px-4 py-2 text-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Production</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
          <%
            screens = {
              "Payments" => { local: ["payments.spec.js", "payments-add-modal.spec.js", "payments-cm2-layout.spec.js", "payments-csv-export.spec.js", "payments-cursor-flow.spec.js", "payments-responsive-filters.spec.js", "payments-filter-grid.spec.js", "payments-modal-date-fix.spec.js", "payments-sticky-subheader.spec.js", "payment-add-refresh.spec.js", "payment-delete-balance.spec.js"],
                              prod: ["prod-add-modal.spec.js", "prod-cm2-layout.spec.js", "prod-csv-export.spec.js", "prod-responsive-filters.spec.js", "prod-payments-filter-grid.spec.js", "prod-payments-modal-date.spec.js", "prod-sticky-subheader.spec.js", "prod-payment-refresh.spec.js", "prod-payment-delete-balance.spec.js", "prod-cm1-payments.spec.js"] },
              "Dashboard" => { local: ["dashboard-tracking-only.spec.js", "net-worth-dashboard.spec.js", "dashboard-updates.spec.js", "dashboard-preserve-style.spec.js", "dashboard-card2-flip.spec.js", "dashboard-header.spec.js", "dashboard-card2-pie-labels.spec.js", "dashboard-card1-flip.spec.js"],
                                prod: ["prod-net-worth.spec.js", "prod-dashboard-updates.spec.js", "prod-dashboard-style.spec.js", "prod-dashboard-card2-flip.spec.js", "prod-card2-pie-labels.spec.js", "prod-dashboard-header.spec.js", "prod-cm1-dashboard-month-scope.spec.js", "prod-cm2-card1-flip.spec.js"] },
              "Settings" => { local: ["profile_settings.spec.js", "settings-phone-parity.spec.js", "settings-modifications.spec.js", "email-phone-verification.spec.js"],
                              prod: ["prod-phone-parity.spec.js"] },
              "Categories" => { local: ["spending_categories.spec.js"], prod: [] },
              "Transfers" => { local: ["transfers-local.spec.js"], prod: ["prod-transfers.spec.js"] },
              "Account Types" => { local: ["account-types-use-flag.spec.js"], prod: ["prod-account-types-use-flag.spec.js"] },
              "Open Month" => { local: ["open-month-master.spec.js"], prod: ["prod-open-month.spec.js"] },
              "Frequencies" => { local: ["frequencies-view-all.spec.js", "freq-master-delete.spec.js"], prod: ["prod-frequencies.spec.js"] },
              "DBU" => { local: ["dbu-schema-inspector.spec.js", "dbu-record-browser-parity.spec.js", "dbu-update.spec.js", "dbu-add-record.spec.js"],
                         prod: ["prod-dbu-schema.spec.js", "prod-dbu-record-browser.spec.js", "prod-dbu-update.spec.js", "prod-dbu-add-record.spec.js"] },
              "Quotes" => { local: ["quotes.spec.js", "quotes-update.spec.js"], prod: ["prod-quotes.spec.js", "prod-quotes-update.spec.js"] },
              "Documentation" => { local: ["documentation-pages.spec.js"], prod: ["prod-documentation-pages.spec.js"] },
              "Legal Pages" => { local: ["privacy-policy.spec.js", "privacy-policy-redesign.spec.js"], prod: ["prod-privacy-policy.spec.js"] },
              "Layout / Nav" => { local: ["footer.spec.js", "dark_mode_review.spec.js", "sticky-header.spec.js", "stacked-sticky-headers.spec.js", "sidebar-toggle-position.spec.js"],
                                  prod: [] },
              "Multi-Screen / Releases" => { local: ["multi-screen-updates.spec.js", "comprehensive.spec.js", "localhost-review.spec.js", "generate_data_button.spec.js", "ui-audit-v116.spec.js", "local-apple-numbers-upload.spec.js"],
                                  prod: ["production-regression.spec.js", "prod-v116-release.spec.js", "prod-v118-cm3-7.spec.js", "prod-v119-cm8.spec.js", "prod-v120-batch3.spec.js", "prod-v121-batch1.spec.js", "prod-v122-apple-numbers.spec.js", "prod-manual-release.spec.js"] }
            }
          %>
          <% screens.each do |screen, files| %>
            <tr>
              <td class="px-4 py-2 font-medium text-gray-900 dark:text-white"><%= screen %></td>
              <td class="px-4 py-2 text-center">
                <% if files[:local].any? %>
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/40 text-green-700 dark:text-green-300"><%= files[:local].length %> file<%= files[:local].length != 1 ? 's' : '' %></span>
                <% else %>
                  <span class="text-xs text-gray-400">&mdash;</span>
                <% end %>
              </td>
              <td class="px-4 py-2 text-center">
                <% if files[:prod].any? %>
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300"><%= files[:prod].length %> file<%= files[:prod].length != 1 ? 's' : '' %></span>
                <% else %>
                  <span class="text-xs text-gray-400">&mdash;</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
