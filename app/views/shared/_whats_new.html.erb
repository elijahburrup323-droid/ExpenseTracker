<% if session[:last_seen_version] != APP_VERSION %>
  <% session[:last_seen_version] = APP_VERSION %>
  <div id="whatsNewOverlay" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onclick="if(event.target===this)document.getElementById('whatsNewOverlay').remove()">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden" style="max-height: 85vh;">
      <div class="bg-gradient-to-r from-brand-600 to-brand-700 px-6 py-4">
        <h2 class="text-lg font-bold text-white">What's New in v<%= APP_VERSION %></h2>
        <p class="text-brand-200 text-sm mt-0.5">MyBudgetHQ has been updated</p>
      </div>
      <div class="px-6 py-4 overflow-y-auto" style="max-height: calc(85vh - 120px);">
        <% APP_VERSIONS.each_with_index do |release, idx| %>
          <% if idx > 0 %>
            <div class="border-t border-gray-200 dark:border-gray-700 my-3"></div>
          <% end %>
          <h3 class="text-sm font-semibold <%= idx == 0 ? 'text-brand-600 dark:text-brand-400' : 'text-gray-500 dark:text-gray-400' %> mb-2">
            v<%= release[:version] %><%= idx == 0 ? ' â€” Latest' : '' %>
          </h3>
          <ul class="space-y-1.5">
            <% release[:changes].each do |item| %>
              <li class="flex items-start space-x-2 text-sm <%= idx == 0 ? 'text-gray-700 dark:text-gray-300' : 'text-gray-400 dark:text-gray-500' %>">
                <svg class="w-4 h-4 flex-shrink-0 mt-0.5 <%= idx == 0 ? 'text-brand-500' : 'text-gray-300 dark:text-gray-600' %>" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                </svg>
                <span><%= item %></span>
              </li>
            <% end %>
          </ul>
        <% end %>
      </div>
      <div class="px-6 py-3 bg-gray-50 dark:bg-gray-900/50 flex justify-end">
        <button type="button" onclick="document.getElementById('whatsNewOverlay').remove()" class="px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg transition">
          Got it
        </button>
      </div>
    </div>
  </div>
<% end %>
